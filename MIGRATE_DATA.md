# Миграция данных из SQLite в PostgreSQL

## Проблема
При переходе с SQLite на PostgreSQL данные (буклеты и брошюры) остались в старой базе данных.

## Решение

### 1. Убедитесь, что у вас есть:
- Файл `collection.db` с данными SQLite
- Настроен `DATABASE_URL` в `.env` файле (строка подключения к PostgreSQL)

### 2. Запустите миграцию

```bash
npm run migrate:buklets
```

Или напрямую:
```bash
node migrate-buklets-brochures.js
```

### 3. Что мигрируется:

- ✅ **Буклеты** (`buklets`)
  - Основная информация о буклетах
  - Группы файлов (`buklet_file_groups`)
  - Изображения (`buklet_images`)
  - PDF файлы (`buklet_pdfs`)

- ✅ **Брошюры** (`brochures`)
  - Основная информация о брошюрах
  - Главное изображение
  - Группы файлов (`brochure_file_groups`)
  - Изображения (`brochure_images`)
  - PDF файлы (`brochure_pdfs`)

### 4. Что делает скрипт:

1. Подключается к SQLite базе данных (`collection.db`)
2. Подключается к PostgreSQL через Prisma
3. Читает все буклеты и брошюры из SQLite
4. Проверяет, не существуют ли уже записи с такими ID
5. Создает записи в PostgreSQL, сохраняя оригинальные ID
6. Мигрирует все связанные данные (группы файлов, изображения, PDF)

### 5. Важно:

- Скрипт **не удаляет** данные из SQLite
- Если запись с таким ID уже существует в PostgreSQL, она пропускается
- Все бинарные данные (изображения, PDF) конвертируются в Buffer для PostgreSQL
- Оригинальные ID сохраняются

### 6. Если возникли ошибки:

- Проверьте, что `DATABASE_URL` правильно настроен в `.env`
- Убедитесь, что файл `collection.db` существует
- Проверьте, что PostgreSQL доступен и таблицы созданы (запустите `npx prisma migrate deploy`)

### 7. После миграции:

После успешной миграции все буклеты и брошюры должны появиться в PostgreSQL и быть доступны через приложение.

